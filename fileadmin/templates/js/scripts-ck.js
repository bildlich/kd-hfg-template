/* global History:true*//* global DocumentTouch:true*//* global ga:true*//* global console:true*/var K={init:function(e){K.config=e;$.ajaxSetup({cache:!0,timeout:1e4});K.enableAjaxPageLoad();K.bindEvents();var t=$("body").data("pageslug");K.smallDeviceMagic();K.setupPage(t);console.log("test")},centerVert:function(e){var t=e.width(),n=e.parent().height(),r=e.data("width"),i=e.data("height"),s=i/r,o=i;o=Math.min(t*s,i,n);var u=Math.max(n/2-o/2-20,0);e.children("img,video,embed,object,iframe").first().css({top:u,height:o});var a={containerWidth:t,containerHeight:n,nodeWidth:r,nodeHeight:i,nodeScaledHeight:o};console.log(a)},changeDisplayMode:function(e){e==="mode-stack"&&K.ele.cards.each(function(){K.positionCard($(this),K.config.filterKey)});K.ele.stackArea.removeClass("mode-stack mode-list").addClass(e)},closeDetails:function(){K.ele.projectDetails.removeClass("open");var e=$("div.project-details a#btn-close");History.pushState({what:"page",newSlug:"projects"},"Projekte",e.attr("href"))},displayDetails:function(){var e,t;if(K.config.isTouchDevice===!0){e=">li:not(.video)";t=!0}else{e=">li";t=!1}var n=$("#detail-slideshow"+e).first();K.centerVert(n);K.ele.detailSlideshow.on("cycle-initialized",function(){K.ele.detailSlideshow.removeClass("loading")}).on("cycle-update-view",function(e,t,n,r){var i=$(r).children().eq(0),s=i.get(0);s.tagName==="VIDEO"&&s.play();ga("send","event","Projekt-Medien","view",s.tagName)}).on("cycle-after",function(e,t,n){var r=$(n).children().eq(0),i=r.get(0);if(i.tagName==="VIDEO"&&i.paused===!1){r.css("diplay","none");i.pause()}}).on("cycle-next cycle-prev",function(e,t){var n=t.slides,r=0;e.type==="cycle-next"?r=1:r=-1;var i=$(n[t.currSlide%n.length]);K.centerVert(i)}).on("cycle-destroyed",function(){$("#detail-slideshow video").each(function(){this.pause()})});K.ele.detailSlideshow.addClass("loading").cycle({speed:300,timeout:3e3,slides:e,paused:!0,fx:"scrollHorz",swipe:!0,youtube:!0})},loadPageAjax:function(e,t){var n,r=$("body").data("pageslug");if(r==="project-details"&&t==="projects"){K.tearDownPage("project-details");K.closeDetails();if($("#stack-area").length)return}$("body").data("pageslug",t);var i=$(".page#"+t),s,o;$.ajax({url:e.url,dataType:"html",beforeSend:function(){$(".page").removeClass("open translate-more translate-less");i.nextAll(".page").addClass("right");i.prevAll(".page").removeClass("right");i.addClass("open").removeClass("right");s=$(".ajax-load-me")},success:function(e){var t=$(e);n=t.find(".ajax-load-me");document.title=t.filter("title").text()},error:function(){n='<div class="scroll ajax-error ajax-load-me"><article class="ajax-error"><p>:-/<br>Beim Laden der Seite ist ein Fehler aufgetreten. Bitte 端berpr端fe deine Internetverbindung. Wenn das Problem bestehen bleibt, schreibe eine kurze Mail an kd-archiv <em>AT</em> hfg-karlsruhe.de</p><p>Danke!</p></article></div>';o=":-/ Fehler"},complete:function(){r===t?s.fadeOut(500,function(){s.remove();K.tearDownPage(r);i.prepend(n);K.setupPage(t)}):window.setTimeout(function(){s.remove();K.tearDownPage(r);i.prepend(n);K.setupPage(t)},500)}})},loadProjectAjax:function(e){var t;$("body").data("pageslug","project-details");$.ajax({url:e.url,dataType:"html",beforeSend:function(){K.ele.projectDetails.addClass("open")},success:function(e){var n=$(e);t=n.closest(".project-details").html();document.title=n.filter("title").text()},error:function(){t='<div class="ajax-error ajax-load-me"><p>:-/<br>Beim Laden der Seite ist ein Fehler aufgetreten. Bitte 端berpr端fe deine Internetverbindung. Wenn das Problem bestehen bleibt, schreibe eine kurze Mail an kd-archiv <em>AT</em> hfg-karlsruhe.de</p><p>Danke!</p></div>'},complete:function(){if(K.ele.projectDetails.hasClass("open")){K.ele.projectDetails.html(t);K.setupPage("project-details",!0)}}})},enableAjaxPageLoad:function(){var e=window.History;if(!e.enabled)return!1;e.Adapter.bind(window,"statechange",function(){var t=e.getState();t.data.what==="page"?K.loadPageAjax(t,t.data.newSlug):t.data.what==="project"&&K.loadProjectAjax(t)});$(document).ajaxStart(function(){$("body").addClass("loading")}).ajaxStop(function(){$("body").removeClass("loading")})},moveToFront:function(e){e.css("z-index",K.config.stackHighestZIndex).addClass("addedZ");K.config.stackHighestZIndex++},orderCards:function(e){$(".stack").each(function(){var t=$(this).children("li").toArray();e==="mode-list"?t.sort(function(e,t){return $(t).data("pid")-$(e).data("pid")}):e==="mode-stack"&&t.sort(function(e,t){return $(e).data("pid")-$(t).data("pid")});$(t).appendTo($(this))})},positionCard:function(e,t){var n=e.width(),r=240,i=K.config.stackWidth,s=K.config.stackHeight;if(e.is(":only-of-type")){e.css({left:i/2-n/2,top:(s-K.config.stackHeaderSpace)/2-r/2+K.config.stackHeaderSpace});return}if(t==="all"){i=K.config.mainStackWidth;s=K.config.mainStackHeight}var o=Math.floor(Math.random()*(i-n)),u=Math.floor(Math.random()*(s-K.config.stackHeaderSpace-r))+K.config.stackHeaderSpace;e.css({left:o,top:u})},putCardsInStacks:function(e){$(".card.clone").remove();K.ele.cards.each(function(){var t=$(this);t.hasClass("addedZ")&&t.removeClass("addedZ").css("z-index","");if(typeof t.data("sort-data")[e]=="object"){var n=t.data("sort-data")[e];$.each(n,function(n,r){var i;if(n===0){i=t;i.addClass("origin")}else{i=t.clone();i.removeClass("origin").addClass("clone");i.draggable()}i.appendTo(K.stackObj(e,r)).length!==1&&K.ele.stackArea.append("<ul class='stack key-"+e+"' data-sort-data='{\""+e+'": "'+r+"\"}'><h2>"+r+"</h2></ul>").find("ul").last().append(i);K.positionCard(i,e)})}else{t.appendTo(K.stackObj(e,t.data("sort-data")[e])).length!==1&&K.ele.stackArea.append("<ul class='stack key-"+e+"' data-sort-data='{\""+e+'": "'+t.data("sort-data")[e]+"\"}'><h2>"+t.data("sort-data")[e]+"</h2></ul>").find("ul").last().append(t);K.positionCard(t,e)}});$(".stack").not(K.stackObj(e)).remove();var t=$(".stack").toArray();e!=="all"&&t.sort(function(t,n){t=$(t).data("sort-data")[e];n=$(n).data("sort-data")[e];return t>n?1:t<n?-1:0});e==="year"&&t.reverse();K.ele.stackArea.append(t)},scrollToTop:function(){var e;K.config.isSmallDevice?e="body":e=".scroll";$(e).animate({scrollTop:0},"slow")},setupPage:function(e,t){ga("send","pageview",window.location.pathname);t!==!0&&$(".scroll").scrollTop(0);$(".page.open .scroll").waypoint(function(e){e==="down"?$("a.btn-top").addClass("show"):e==="up"&&$("a.btn-top").removeClass("show")},{offset:-300});if(e==="index"){K.ele={slideShowContainer:$("#intro-slider")};if(K.ele.slideShowContainer.hasClass("cycle-paused"))K.ele.slideShowContainer.cycle("resume");else{$("#intro-slider").on("cycle-initialized",function(){$("#intro-slider").fadeIn()});$("#intro-slider").cycle({speed:500,timeout:3e3,slides:"> li"})}}else if(e==="projects"){K.ele={cards:$(".card"),hiddenStack:$("#stack-area #hidden-stack"),projectDetails:$(".project-details"),stackArea:$("#stack-area")};K.ele.hiddenStack.hide();K.stackNavChange("order-by",K.config.filterKey);K.stackNavChange("show-as",K.config.displayMode);K.config.isSmallDevice||K.ele.cards.draggable()}else if(e==="project-details"){typeof K.ele!="object"&&(K.ele={});K.ele.detailSlideshow=$("#detail-slideshow");K.ele.projectDetails=$(".project-details");K.displayDetails()}else e==="info"&&$("section").waypoint(function(e){$(".sub-nav a").removeClass("active");var t;e==="down"?t=this.id:e==="up"&&(t=$(this).prev("section").attr("id"));$('a[href="#'+t+'"]').addClass("active")},{context:".scroll",offset:"5%"})},stackNavChange:function(e,t){K.ele.stackArea.fadeOut(400,function(){switch(e){case"order-by":K.config.filterKey=t;K.putCardsInStacks(t);break;case"show-as":K.config.displayMode=t;K.changeDisplayMode(t)}K.orderCards(t);K.ele.stackArea.fadeIn(400)});$("#stack-nav ul."+e+" a").removeClass("active");$("#stack-nav ul."+e+" a[data-value="+t+"]").addClass("active")},stackObj:function(e,t){return $(".stack").filter(function(){return typeof t!="undefined"?$(this).data("sort-data")[e]===t:$(this).data("sort-data").hasOwnProperty(e)})},smallDeviceMagic:function(){function t(){var e;if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)e=!0;return e}var e=window.innerWidth>0?window.innerWidth:screen.width;if(e<K.config.screenWidthMobile){K.config.isSmallDevice=!0;$("body").addClass("small-device");$("body").data("pageslug")==="index"&&$("#smallscreen-menu ul li:first-child a").trigger("click");$("div#index").remove();$("body").append('<a class="btn-top" href="#top"></a>')}else K.config.isSmallDevice=!1;$(".test").html(e);if(t()){K.config.isTouchDevice=!0;$("body").addClass("touch-device");K.config.displayMode="mode-list"}else K.config.isTouchDevice=!1},tearDownPage:function(e){$.waypoints("destroy");if(e==="index"){K.ele.slideShowContainer.cycle("goto",0);K.ele.slideShowContainer.cycle("pause")}else if(e==="projects")$("#detail-slideshow").cycle("destroy");else if(e==="project-details"){$("#detail-slideshow").cycle("destroy");K.ele.projectDetails.children().not("#btn-close").remove()}},bindEvents:function(){$(document).on("click","div#index.open",function(e){e.preventDefault();$("body").hasClass("loading")||$("div#projects .main-nav a").trigger("click")});$(document).on("click",".card a",function(e){e.preventDefault();if(!$("body").hasClass("loading")){var t=$(this).attr("href");History.pushState({what:"project"},"Projektdetails",t)}}).on("click",".project-details #btn-close",function(e){e.preventDefault();K.closeDetails()}).on("click",".project-details #btn-info",function(e){e.preventDefault();ga("send","pageview",window.location.pathname+"project-words");$("#project-words").addClass("open")}).on("click","#project-words",function(e){var t=$(e.target);t.is("a:not(#btn-words-close)")?t.attr("target","_blank"):$("#project-words").removeClass("open")}).on("click","#stack-nav a",function(e){e.preventDefault();var t=$(this).parent().parent().attr("data-menu"),n=$(this).data("value");K.stackNavChange(t,n);ga("send","event","Projekt-Filter","click",t)}).on("mousedown",".mode-stack li",function(){K.config.isSmallDevice||K.moveToFront($(this))}).on("dragstop",".mode-stack li",function(){ga("send","event","Projekt-DragNDrop","drag")});$(document).on("click","#info .sub-nav li a",function(e){e.preventDefault();var t;K.config.isSmallDevice?t="body":t="#info .scroll";var n=$(this).attr("href");$(t).animate({scrollTop:$(n).offset().top+$(t).scrollTop()},"slow")}).on("click","#info #show-all-teachers",function(e){e.preventDefault();var t=$(this),n=t.text();t.text(t.data("switch-word"));t.data("switch-word",n);$(".teachers-list-small").toggleClass("open")}).on("click","#info #show-alumni",function(e){e.preventDefault();var t=$(this),n=t.text();t.text(t.data("switch-word"));t.data("switch-word",n);$(".alumni-list").toggleClass("open")});$(document).on("mouseenter",".page:not(.open, .right)",function(){$(this).removeClass("translate-more").nextAll(".page").addClass("translate-more");$(this).prevAll(".page").removeClass("translate-more")}).on("mouseleave",".page:not(.open, .right)",function(){$(".page, .fixed").removeClass("translate-more")}).on("mouseenter",".page.right",function(){$(this).prevAll(".right").addClass("translate-less");$(this).addClass("translate-less")}).on("mouseleave",".page.right",function(){$(this).removeClass("translate-less").prev().removeClass("translate-less")}).on("click",".main-nav a, #news article h2 a",function(e){e.preventDefault()}).on("click",".page:not(.open)",function(){if(!$("body").hasClass("loading")){var e=$(this).find(".main-nav a"),t=e.data("pageslug");History.pushState({what:"page",newSlug:t},e.text(),e.attr("href"))}}).on("click","a.ajax",function(e){e.preventDefault();if(!$("body").hasClass("loading")){var t=$(this),n=t.data("pageslug");History.pushState({what:"page",newSlug:n},t.text(),$(this).attr("href"))}}).on("click",".page.open .main-nav a",function(e){e.preventDefault();var t=$(this).parent().parent().next(".page");t.trigger("click")}).on("click","a.btn-top",function(e){e.preventDefault();K.scrollToTop()}).on("click",".page:not(.open) a.logo",function(e){e.preventDefault()}).on("click",".page.open a.logo",function(e){e.preventDefault();$("div#index .main-nav a").trigger("click")}).on("keydown",function(e){switch(e.which){case 27:$("#project-words").hasClass("open")?$("#project-words").removeClass("open"):K.ele.projectDetails.hasClass("open")&&K.closeDetails();break;case 74:case 37:$(".project-details").hasClass("open")?K.ele.detailSlideshow.cycle("prev"):$(".page#index").hasClass("open")&&$("#intro-slider").cycle("prev");break;case 75:case 39:$(".project-details").hasClass("open")?K.ele.detailSlideshow.cycle("next"):$(".page#index").hasClass("open")&&$("#intro-slider").cycle("next")}});$(document).on("click","#smallscreen-menu .bar",function(e){e.preventDefault();$("#smallscreen-menu nav").toggleClass("active")}).on("click","#smallscreen-menu nav a",function(e){e.preventDefault();$("#smallscreen-menu nav").removeClass("active");$(".project-details").removeClass("open");$("#btn-smallscreen-menu").text($(this).text());var t=$(this).attr("href"),n=$(this).data("pageslug");History.pushState({what:"page",newSlug:n},$(this).text(),t)})}};K.init({filterKey:"all",displayMode:"mode-stack",mainStackWidth:650,mainStackHeight:650,stackWidth:350,stackHeight:300,stackHeaderSpace:25,stackLowestZIndex:100,stackHighestZIndex:500,screenWidthMobile:602});